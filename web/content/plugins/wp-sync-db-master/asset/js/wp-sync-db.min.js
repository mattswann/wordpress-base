var connection_data,next_step_in_migration,migration_complete,migration_complete_events,migrate_table_recursive,execute_next_step,hooks=[],call_stack=[],non_fatal_errors="",migration_error=!1;function wpsdb_call_next_hook(){call_stack.length||(call_stack=hooks);var e=call_stack[0];call_stack.shift(),window[e]()}function wpsdb_add_commas(e){x=(e+="").split("."),x1=x[0],x2=1<x.length?"."+x[1]:"";for(var t=/(\d+)(\d{3})/;t.test(x1);)x1=x1.replace(t,"$1,$2");return x1+x2}function validate_url(e){return/^([a-z]([a-z]|\d|\+|-|\.)*):(\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?((\[(|(v[\da-f]{1,}\.(([a-z]|\d|-|\.|_|~)|[!\$&'\(\)\*\+,;=]|:)+))\])|((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=])*)(:\d*)?)(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*|(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)){0})(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)}jQuery.wpsdb={hooks:{action:{},filter:{}},add_action:function(e,t,n){jQuery.wpsdb.add_hook("action",e,t,n)},add_filter:function(e,t,n){jQuery.wpsdb.add_hook("filter",e,t,n)},do_action:function(e,t){jQuery.wpsdb.do_hook("action",e,null,t)},apply_filters:function(e,t,n){return jQuery.wpsdb.do_hook("filter",e,t,n)},remove_action:function(e,t){jQuery.wpsdb.remove_hook("action",e,t)},remove_filter:function(e,t){jQuery.wpsdb.remove_hook("filter",e,t)},add_hook:function(e,t,n,s){null==jQuery.wpsdb.hooks[e][t]&&(jQuery.wpsdb.hooks[e][t]=[]);var i=jQuery.wpsdb.hooks[e][t];null==s&&(s=t+"_"+i.length),jQuery.wpsdb.hooks[e][t].push({tag:s,callable:n})},do_hook:function(e,t,n,s){if(null!=jQuery.wpsdb.hooks[e][t])for(var i=jQuery.wpsdb.hooks[e][t],o=0;o<i.length;o++)"action"==e?i[o].callable(s):n=i[o].callable(n,s);if("filter"==e)return n},remove_hook:function(e,t,n){if(null!=jQuery.wpsdb.hooks[e][t])for(var s=jQuery.wpsdb.hooks[e][t],i=s.length-1;0<=i;i--)null!=n&&n!=s[i].tag||s.splice(i,1)}},function(b){var m,f,g,w,v,x,k,y,F,j,C,T=!1,z="",D=!1,O=!1,A=!1,S=!1,P=!1,E=!1,I=!1,Q=!1,$=!1,M=!1,R="",q="",U="",X=!1,W=!1,B=ajaxurl.replace("/admin-ajax.php","")+"/images/wpspin_light";function t(e,t,n){return n=n||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(n)+e}function N(){j+=1,function(){hours=Math.floor(j/3600)%24,minutes=Math.floor(j/60)%60,seconds=j%60;var e=label+t(hours,2,0)+":"+t(minutes,2,0)+":"+t(seconds,2,0);counter_display.html(e)}()}function H(e,t){var n,s,i=[],o={},a=t.length;for(n=0;n<a;n++)o[t[n]]=!0;for(a=e.length,n=0;n<a;n++)(s=e[n])in o&&i.push(s);return i}function J(e,t,n){if(n!=e.substr(0,e.indexOf(":"))&&-1!=e.indexOf("https"))return b(".ssl-notice").show(),I=!0,e=e.replace("https","http"),void b(".pull-push-connection-info").val(e+"\n"+t);I=!1}function V(e,t){void 0!==e&&e!=wpsdb_plugin_version&&(b(".different-plugin-version-notice").show(),b(".remote-version").html(e),b(".remote-location").html(t),b(".step-two").hide(),Q=!0)}function G(e){e!=wpsdb_this_prefix&&(b(".remote-prefix").html(e),E=!0,b("#pull").is(":checked")?b(".prefix-notice.pull").show():b(".prefix-notice.push").show())}function K(e){return e.replace(/\/\/(.*)@/,"//").replace("http://","").replace("https://","").replace("www.","")}function L(e,t,n){var s=K(e),i=t;i=i.charAt(0).toUpperCase()+i.slice(1),n&&(i+="ing");var o="to";return"pull"==t&&(o="from"),profile_name=i+" "+o+" "+s}function Y(e){return e.replace(/^https?:/i,"")}2<=window.devicePixelRatio&&(B+="-2x"),B+=".gif",window.onbeforeunload=function(e){if(M)return(e=e||window.event)&&(e.returnValue="Sure?"),"Sure?"},b(document).ready(function(){b("#plugin-compatibility").change(function(e){var t="1";if(b(this).is(":checked")){if(!confirm('If confirmed we will install an additional WordPress "Must Use" plugin. This plugin will allow us to control which plugins are loaded during WP Sync DB specific operations. Do you wish to continue?'))return void b(this).prop("checked",!1)}else t="0";b(".plugin-compatibility-wrap").toggle(),b(this).parent().append('<img src="'+B+'" alt="" class="ajax-spinner general-spinner" />'),b("#plugin-compatibility").attr("disabled","disabled"),b(".plugin-compatibility").addClass("disabled"),b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_plugin_compatibility",install:t},error:function(e,t,n){alert("A problem occurred when trying to change the plugin compatibility setting.\r\n\r\nStatus: "+e.status+" "+e.statusText+"\r\n\r\nResponse:\r\n"+e.responseText),b(".ajax-spinner").remove(),b("#plugin-compatibility").removeAttr("disabled"),b(".plugin-compatibility").removeClass("disabled")},success:function(e){""!=b.trim(e)?alert(e):(b(".plugin-compatibility").append('<span class="ajax-success-msg">Saved</span>'),b(".ajax-success-msg").fadeOut(2e3,function(){b(this).remove()})),b(".ajax-spinner").remove(),b("#plugin-compatibility").removeAttr("disabled"),b(".plugin-compatibility").removeClass("disabled")}})}),b("#plugin-compatibility").is(":checked")&&b(".plugin-compatibility-wrap").show(),(0<navigator.userAgent.indexOf("MSIE")||0<navigator.userAgent.indexOf("Trident"))&&b(".ie-warning").show(),b(".slider").slider({range:"min",value:wpsdb_max_request/1024,min:512,max:wpsdb_bottleneck/1024,step:512,slide:function(e,t){b(".amount").html(wpsdb_add_commas(t.value)+" kB")},change:function(e,t){b(".amount").after('<img src="'+B+'" alt="" class="slider-spinner general-spinner" />'),b(".slider").slider("disable"),b.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"wpsdb_update_max_request_size",max_request_size:parseInt(t.value),nonce:wpsdb_nonces.update_max_request_size},error:function(e,t,n){b(".slider").slider("enable"),b(".slider-spinner").remove(),alert(wpsdb_i10n.max_request_size_problem)},success:function(e){b(".slider").slider("enable"),b(".slider-spinner").remove(),b(".slider-success-msg").show(),b(".slider-success-msg").fadeOut(2e3,function(){b(this).hide()})}})}}),b(".amount").html(wpsdb_add_commas(b(".slider").slider("value"))+" kB");var r=b(".progress-content").clone();b(".progress-content").remove();var e=b("#select-tables").clone(),c=b("#select-tables").clone(),t=b("#select-post-types").clone(),p=b("#select-post-types").clone(),d=b("#select-backup").clone(),u=b("#select-backup").clone();function l(){b(".option-group").each(function(e){b("input",this).attr("disabled","disabled"),b("label",this).css("cursor","default")})}function _(){b(".option-group").each(function(e){b("input",this).removeAttr("disabled"),b("label",this).css("cursor","pointer")})}function n(){b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_get_log",nonce:wpsdb_nonces.get_log},error:function(e,t,n){alert(wpsdb_i10n.update_log_problem)},success:function(e){b(".debug-log-textarea").val(e)}})}function s(){var e=b(".progress-content").outerHeight();b(".progress-content").animate({top:"-"+e+"px"},400,"swing",function(){b("#overlay").remove(),b(".progress-content").remove()}),$=!1}function h(){b(".connection-status").hide(),b(".prefix-notice").hide(),b(".ssl-notice").hide(),b(".different-plugin-version-notice").hide(),b(".step-two").show(),b(".backup-options").show(),b(".keep-active-plugins").show(),b(".directory-permission-notice").hide(),b("#create-backup").removeAttr("disabled"),b("#create-backup-label").removeClass("disabled"),b(".backup-option-disabled").hide();var e=b.trim(b(".pull-push-connection-info").val()).split("\n");if(b("#pull").is(":checked"))if(b(".pull-list li").append(connection_info_box),connection_info_box.show(),T){if(b(".connection-status").hide(),b(".step-two").show(),b(".table-prefix").html(connection_data.prefix),b(".uploads-dir").html(wpsdb_this_uploads_dir),0==P){var t=K(e[0]);b(".create-new-profile").val(t)}1==E&&b(".prefix-notice.pull").show(),1==I&&b(".ssl-notice").show(),1==Q&&(b(".different-plugin-version-notice").show(),b(".step-two").hide()),b(".directory-scope").html("local"),0==wpsdb_write_permission&&(b("#create-backup").prop("checked",!1),b("#create-backup").attr("disabled","disabled"),b("#create-backup-label").addClass("disabled"),b(".backup-option-disabled").show(),b(".upload-directory-location").html(wpsdb_this_upload_dir_long))}else b(".connection-status").show(),b(".step-two").hide();else if(b("#push").is(":checked"))if(b(".push-list li").append(connection_info_box),connection_info_box.show(),T){if(b(".connection-status").hide(),b(".step-two").show(),b(".table-prefix").html(wpsdb_this_prefix),b(".uploads-dir").html(connection_data.uploads_dir),0==P){t=K(e[0]);b(".create-new-profile").val(t)}1==E&&b(".prefix-notice.push").show(),1==I&&b(".ssl-notice").show(),1==Q&&(b(".different-plugin-version-notice").show(),b(".step-two").hide()),b(".directory-scope").html("remote"),"0"==connection_data.write_permissions&&(b("#create-backup").prop("checked",!1),b("#create-backup").attr("disabled","disabled"),b("#create-backup-label").addClass("disabled"),b(".backup-option-disabled").show(),b(".upload-directory-location").html(connection_data.upload_dir_long))}else b(".connection-status").show(),b(".step-two").hide();else b("#savefile").is(":checked")&&(b(".connection-status").hide(),b(".step-two").show(),b(".table-prefix").html(wpsdb_this_prefix),0==P&&b(".create-new-profile").val(""),b(".backup-options").hide(),b(".keep-active-plugins").hide(),0==wpsdb_write_permission&&(b(".directory-permission-notice").show(),b(".step-two").hide()));b.wpsdb.do_action("move_connection_info_box")}if(b(".help-tab .video").each(function(){var n=b(this),s=b(".video-viewer");b("a",this).click(function(e){e.preventDefault(),s.attr("src","//www.youtube.com/embed/"+n.data("video-id")+"?autoplay=1"),s.show();var t=s.offset();b(window).scrollTop(t.top-50)})}),b(".backup-options").show(),b(".keep-active-plugins").show(),b("#savefile").is(":checked")&&(b(".backup-options").hide(),b(".keep-active-plugins").hide()),function(){var e=b("input[name=action]:checked").val(),t=b.trim(b(".pull-push-connection-info").val()).split("\n");if("undefined"==typeof wpsdb_default_profile||1==wpsdb_default_profile||"savefile"==e||D)return;z=e,D=!0,l(),b(".connection-status").html(wpsdb_i10n.establishing_remote_connection),b(".connection-status").removeClass("notification-message error-notice migration-error"),b(".connection-status").append('<img src="'+B+'" alt="" class="ajax-spinner general-spinner" />');var n=b("input[name=action]:checked").val();b.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"wpsdb_verify_connection_to_remote_site",url:t[0],key:t[1],intent:n,nonce:wpsdb_nonces.verify_connection_to_remote_site,convert_post_type_selection:wpsdb_convert_post_type_selection,profile:wpsdb_profile},error:function(e,t,n){b(".connection-status").html(wpsdb_i10n.connection_local_server_problem+" (#102)"),b(".connection-status").append("<br /><br />Status: "+e.status+" "+e.statusText+"<br /><br />Response:<br />"+e.responseText),b(".connection-status").addClass("notification-message error-notice migration-error"),b(".ajax-spinner").remove(),D=!1,_()},success:function(e){if(b(".ajax-spinner").remove(),D=!1,_(),void 0!==e.wpsdb_error&&1==e.wpsdb_error)return b(".connection-status").html(e.body),b(".connection-status").addClass("notification-message error-notice migration-error"),void(-1<e.body.indexOf("401 Unauthorized")&&b(".basic-access-auth-wrapper").show());J(t[0],t[1],e.scheme),V(e.plugin_version,t[0]),G(e.prefix),b(".pull-push-connection-info").addClass("temp-disabled"),b(".pull-push-connection-info").attr("readonly","readonly"),b(".connect-button").hide(),b(".connection-status").hide(),b(".step-two").show(),T=!0,connection_data=e,h();var s="";0==wpsdb_default_profile&&"undefined"!=typeof wpsdb_loaded_tables&&(s=wpsdb_loaded_tables);var i=document.createElement("select");b(i).attr({multiple:"multiple",name:"select_tables[]",id:"select-tables",class:"multiselect"}),b.each(connection_data.tables,function(e,t){var n=b.inArray(t,s);n=-1!=n?' selected="selected" ':" ",b(i).append("<option"+n+'value="'+t+'">'+t+" ("+connection_data.table_sizes_hr[t]+")</option>")}),c=i;var o="";0==wpsdb_default_profile&&"undefined"!=typeof wpsdb_loaded_post_types&&(o=void 0!==e.select_post_types?(b("#exclude-post-types").attr("checked","checked"),b(".post-type-select-wrap").show(),e.select_post_types):wpsdb_loaded_post_types);var a=document.createElement("select");b(a).attr({multiple:"multiple",name:"select_post_types[]",id:"select-post-types",class:"multiselect"}),b.each(connection_data.post_types,function(e,t){var n=b.inArray(t,o);n=-1!=n||1==wpsdb_convert_exclude_revisions&&"revision"!=t?' selected="selected" ':" ",b(a).append("<option"+n+'value="'+t+'">'+t+"</option>")}),p=a;var r="";0==wpsdb_default_profile&&"undefined"!=typeof wpsdb_loaded_tables_backup&&(r=wpsdb_loaded_tables_backup);var l=document.createElement("select");b(l).attr({multiple:"multiple",name:"select_backup[]",id:"select-backup",class:"multiselect"}),b.each(connection_data.tables,function(e,t){var n=b.inArray(t,r);n=-1!=n?' selected="selected" ':" ",b(l).append("<option"+n+'value="'+t+'">'+t+" ("+connection_data.table_sizes_hr[t]+")</option>")}),d=l,b("#pull").is(":checked")?(b("#select-tables").remove(),b(".select-tables-wrap").prepend(c),b("#select-post-types").remove(),b(".select-post-types-wrap").prepend(p),b("#select-backup").remove(),b(".backup-tables-wrap").prepend(u),b(".table-prefix").html(e.prefix),b(".uploads-dir").html(wpsdb_this_uploads_dir)):(b("#select-backup").remove(),b(".backup-tables-wrap").prepend(d)),b.wpsdb.do_action("verify_connection_to_remote_site",connection_data)}})}(),b(".js-action-link").click(function(e){e.preventDefault(),b(this).blur()}),b(".clear-log").click(function(){b(".debug-log-textarea").val(""),b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_clear_log",nonce:wpsdb_nonces.clear_log},error:function(e,t,n){alert(wpsdb_i10n.clear_log_problem)},success:function(e){}})}),b(".multiselect-select-all").click(function(){var e=b(this).parents(".select-wrap").children(".multiselect");b(e).focus(),b("option",e).attr("selected",1)}),b(".multiselect-deselect-all").click(function(){var e=b(this).parents(".select-wrap").children(".multiselect");b(e).focus(),b("option",e).removeAttr("selected")}),b(".multiselect-invert-selection").click(function(){var e=b(this).parents(".select-wrap").children(".multiselect");b(e).focus(),b("option",e).each(function(){b(this).attr("selected",!b(this).attr("selected"))})}),b(".option-group input[type=radio]").change(function(){group=b(this).closest(".option-group"),b("ul",group).hide(),parent=b(this).closest("li"),b("ul",parent).show()}),b(".option-group").each(function(){b(".option-group input[type=radio]").each(function(){b(this).is(":checked")&&(parent=b(this).closest("li"),b("ul",parent).show())})}),b(".header-expand-collapse").click(function(){b(".expand-collapse-arrow",this).hasClass("collapsed")?(b(".expand-collapse-arrow",this).removeClass("collapsed"),b(this).next().show()):(b(".expand-collapse-arrow",this).addClass("collapsed"),b(this).next().hide())}),b(".checkbox-label input[type=checkbox]").change(function(){b(this).is(":checked")?b(this).parent().next().show():b(this).parent().next().hide()}),b("#save-migration-profile").change(function(){b(this).is(":checked")?(b(".save-settings-button").show(),b(".migrate-db .button-primary").val(wpsdb_i10n.migrate_db_save)):(b(".save-settings-button").hide(),b(".migrate-db .button-primary").val(wpsdb_i10n.migrate_db))}),b("#save-migration-profile").is(":checked")&&(b(".save-settings-button").show(),b(".migrate-db .button-primary").val(wpsdb_i10n.migrate_db_save)),b(".checkbox-label input[type=checkbox]").each(function(){b(this).is(":checked")&&b(this).parent().next().show()}),b("#new-url").change(function(){b("#new-url-missing-warning").hide()}),b("#new-path").change(function(){b("#new-path-missing-warning").hide()}),b(".migrate-db-button").click(function(e){if(b(this).blur(),e.preventDefault(),b("#migrate-selected").is(":checked")&&null==b("#select-tables").val())alert(wpsdb_i10n.please_select_one_table);else if(new_url_missing=!1,new_file_path_missing=!1,b("#new-url").length&&!b("#new-url").val()&&(b("#new-url-missing-warning").show(),b("#new-url").focus(),b("html,body").scrollTop(0),new_url_missing=!0),b("#new-path").length&&!b("#new-path").val()&&(b("#new-path-missing-warning").show(),0==new_url_missing&&(b("#new-path").focus(),b("html,body").scrollTop(0)),new_file_path_missing=!0),1!=new_url_missing&&1!=new_file_path_missing){if(b("#save-migration-profile").is(":checked")){if(""==b.trim(b(".create-new-profile").val())&&b("#create_new").is(":checked"))return alert(wpsdb_i10n.enter_name_for_profile),void b(".create-new-profile").focus();var i=!1;b("#create_new").is(":checked")&&(i=!0);var o=b(".create-new-profile").val();profile=b("#migrate-form").serialize(),b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_save_profile",profile:profile,nonce:wpsdb_nonces.save_profile},error:function(e,t,n){alert(wpsdb_i10n.save_profile_problem)},success:function(e){if(i){var t=parseInt(e,10),n=t+1,s='<li><span style="display: none;" class="delete-profile" data-profile-id="'+n+'"></span><label for="profile-'+n+'"><input id="profile-'+n+'" value="'+t+'" name="save_migration_profile_option" type="radio"> '+o+"</label></li>";b("#create_new").parents("li").before(s),b("#profile-"+n).attr("checked","checked"),b(".create-new-profile").val("")}}})}w=b("#migrate-form").serialize();var t=b(document).height();b("body").append('<div id="overlay"></div>'),b("#overlay").height(t).css({position:"fixed",top:0,left:0,width:"100%","z-index":99999,display:"none"}),$progress_content=r.clone(),m=b("input[name=action]:checked").val(),v="backup","savefile"==m&&(v="migrate"),0==b("#create-backup").is(":checked")&&(v="migrate");var c=b("input[name=table_migrate_option]:checked").val(),n=b.trim(b(".pull-push-connection-info").val()).split("\n"),p="";f=n[0],g=n[1];var s="";b("#overlay").after($progress_content),k=wpsdb_i10n.exporting_complete,"savefile"==m?s=wpsdb_i10n.exporting_please_wait:(s=L(f,m,!0)+", "+wpsdb_i10n.please_wait,k=L(f,m,!0)+" "+wpsdb_i10n.complete),b(".progress-title").html(s),b("#overlay").show(),backup_option=b("input[name=backup_option]:checked").val(),table_option=b("input[name=table_migrate_option]:checked").val(),"backup"==v?("migrate_only_with_prefix"==table_option&&"backup_selected"==backup_option&&(backup_option="backup_only_with_prefix"),"push"==m?(p=connection_data.table_rows,"backup_only_with_prefix"==backup_option?U=connection_data.prefixed_tables:"backup_selected"==backup_option?(selected_tables=b("#select-tables").val(),U=H(selected_tables,connection_data.tables)):"backup_manual_select"==backup_option&&(U=b("#select-backup").val())):(p=wpsdb_this_table_rows,"backup_only_with_prefix"==backup_option?U=wpsdb_this_prefixed_tables:"backup_selected"==backup_option?(selected_tables=b("#select-tables").val(),U=H(selected_tables,wpsdb_this_tables)):"backup_manual_select"==backup_option&&(U=b("#select-backup").val()))):p="migrate_select"==c?(U=b("#select-tables").val(),"push"==m||"savefile"==m?wpsdb_this_table_rows:connection_data.table_rows):"push"==m||"savefile"==m?(U=wpsdb_this_prefixed_tables,wpsdb_this_table_rows):(U=connection_data.prefixed_tables,connection_data.table_rows),table_details=d(U,p),p=table_details[0],total_size=table_details[1],b(".progress-title").after('<img src="'+B+'" alt="" class="migration-progress-ajax-spinner general-spinner" />');var a=b(".progress-content").outerHeight();b(".progress-content").css("top","-"+a+"px").show().animate({top:"0px"}),j=0,counter_display=b(".timer"),label=wpsdb_i10n.time_elapsed+" ",x=setInterval(N,1e3),M=!0,b.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"wpsdb_initiate_migration",intent:m,url:f,key:g,form_data:w,stage:v,nonce:wpsdb_nonces.initiate_migration},error:function(e,t,n){b(".progress-title").html("Migration failed"),b(".progress-text").html(wpsdb_i10n.connection_local_server_problem+" (#112)"),b(".progress-text").append("<br /><br />Status: "+e.status+" "+e.statusText+"<br /><br />Response:<br />"+e.responseText),b(".progress-text").addClass("migration-error"),console.log(e),console.log(t),console.log(n),migration_error=!0,migration_complete_events()},success:function(e){if(void 0!==e.wpsdb_error&&1==e.wpsdb_error)return migration_error=!0,migration_complete_events(),b(".progress-title").html(wpsdb_i10n.migration_failed),b(".progress-text").addClass("migration-error"),void b(".progress-text").html(e.body);q=e.dump_url,R=e.dump_filename;var s=0,i=0,o=C=0,a=0,r=0,l=0;next_step_in_migration={fn:migrate_table_recursive=function(e,t){if(s>=U.length){if("backup"!=v)return(hooks=b.wpsdb.apply_filters("wpsdb_before_migration_complete_hooks",hooks)).push("migration_complete"),(hooks=b.wpsdb.apply_filters("wpsdb_after_migration_complete_hooks",hooks)).push("migration_complete_events"),next_step_in_migration={fn:wpsdb_call_next_hook},void execute_next_step();v="migrate",i=s=0,b(".progress-bar").width("0px"),p="migrate_select"==c?(U=b("#select-tables").val(),"push"==m||"savefile"==m?wpsdb_this_table_rows:connection_data.table_rows):"push"==m||"savefile"==m?(U=wpsdb_this_prefixed_tables,wpsdb_this_table_rows):(U=connection_data.prefixed_tables,connection_data.table_rows),b(".progress-tables").empty(),b(".progress-tables-hover-boxes").empty(),table_details=d(U,p),p=table_details[0],total_size=table_details[1]}"backup"==v?b(".progress-text").html(C+"% - "+wpsdb_i10n.backing_up+' "'+U[s]+'"'):b(".progress-text").html(C+"% - "+wpsdb_i10n.migrating+' "'+U[s]+'"'),last_table=0,s==U.length-1&&(last_table=1),gzip=0,"savefile"!=m&&1==parseInt(connection_data.gzip)&&(gzip=1);var n={action:"wpsdb_migrate_table",intent:m,url:f,key:g,table:U[s],form_data:w,stage:v,current_row:e,dump_filename:R,last_table:last_table,primary_keys:t,gzip:gzip,nonce:wpsdb_nonces.migrate_table};"savefile"!=m&&(n.bottleneck=connection_data.bottleneck,n.prefix=connection_data.prefix),connection_data&&connection_data.path_current_site&&connection_data.domain&&(n.path_current_site=connection_data.path_current_site,n.domain_current_site=connection_data.domain),D=!0,b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,timeout:0,data:n,error:function(e,t,n){b(".progress-title").html("Migration failed"),b(".progress-text").html(wpsdb_i10n.table_process_problem+" "+U[s]),b(".progress-text").append("<br /><br />"+wpsdb_i10n.status+": "+e.status+" "+e.statusText+"<br /><br />"+wpsdb_i10n.response+":<br />"+e.responseText),b(".progress-text").addClass("migration-error"),D=!1,console.log(e),console.log(t),console.log(n),migration_error=!0,migration_complete_events()},success:function(t){D=!1,t=t.trim();try{row_information=JSON.parse(t)}catch(e){return b(".progress-title").html("Migration failed"),""==t||null==t?b(".progress-text").html(wpsdb_i10n.table_process_problem_empty_response+" "+U[s]):b(".progress-text").html(t),b(".progress-text").addClass("migration-error"),migration_error=!0,void migration_complete_events()}if(void 0!==row_information.wpsdb_error&&1==row_information.wpsdb_error)return b(".progress-title").html("Migration failed"),b(".progress-text").addClass("migration-error"),b(".progress-text").html(row_information.body),migration_error=!0,void migration_complete_events();"-1"==row_information.current_row?(i-=l,r=l=0,i+=parseInt(p[U[s]]),s++,row_information.current_row="",row_information.primary_keys=""):(a=parseInt(row_information.current_row),o=a-r,r=a,i+=o,l+=o);var e=100*i/total_size;b(".progress-bar").width(e+"%"),C=Math.floor(e),next_step_in_migration={fn:migrate_table_recursive,args:[row_information.current_row,row_information.primary_keys]},execute_next_step()}})},args:["-1",""]},execute_next_step()}})}function d(n,i){var o=0;b.each(n,function(e,t){o+=parseInt(i[t])});var a="";if(b.each(n,function(e,t){var n=i[t]/o*100,s=Math.round(1e3*n)/1e3;b(".progress-tables").append('<div class="progress-chunk '+t+'_chunk" style="width: '+s+'%;" title="'+t+'"><span>'+t+"</span></div>"),b(".progress-tables-hover-boxes").append('<div class="progress-chunk-hover" data-table="'+t+'" style="width: '+s+'%;"></div>');b(".progress-tables .progress-chunk:last span");a=t}),b(".progress-chunk").each(function(e){b(this).width()<1&&n[e]!=a&&(b(this).hide(),b(".progress-chunk-hover[data-table="+n[e]+"]").hide(),i[a]=Number(i[a]),i[a]+=Number(i[n[e]]),i[n[e]]=0);var t=this;setTimeout(function(){var e;b("span",e=t).innerWidth()>b(e).width()&&b("span",e).hide()},0)}),(t=0)!=i[a])var e=i[a]/o*100,t=Math.round(1e3*e)/1e3;return b(".progress-tables .progress-chunk:last").css("width",t+"%"),b(".progress-chunk-hover:last").css("width",t+"%"),[i,o]}}),migration_complete_events=function(){0==migration_error&&(""==non_fatal_errors?("savefile"!=m&&1==b("#save_computer").is(":checked")&&b(".progress-text").css("visibility","hidden"),b(".progress-title").html(k).append('<div class="dashicons dashicons-yes"></div>')):(b(".progress-text").html(non_fatal_errors),b(".progress-text").addClass("migration-error"),b(".progress-title").html(wpsdb_i10n.completed_with_some_errors)),b(".progress-bar-wrapper").hide()),b(".migration-controls").hide(),hooks=[],D=W=X=!($=!(M=migration_error=!(call_stack=[]))),non_fatal_errors="",b(".progress-label").remove(),b(".migration-progress-ajax-spinner").remove(),b(".close-progress-content").show(),b("#overlay").css("cursor","pointer"),clearInterval(x)},migration_complete=function(){if(b(".migration-controls").fadeOut(),"savefile"==m){M=!1;var e="Migration complete";if(b("#save_computer").is(":checked")){var t=wpsdb_this_download_url+encodeURIComponent(R);b("#gzip_file").is(":checked")&&(t+="&gzip=1"),window.location=t}else e=wpsdb_i10n.completed_dump_located_at+' <a href="'+q+'">'+q+"</a>.";0==migration_error&&(b(".progress-text").html(e),migration_complete_events(),b(".progress-title").html(k))}else b(".progress-text").html("Finalizing migration"),b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_finalize_migration",intent:m,url:f,key:g,form_data:w,prefix:connection_data.prefix,temp_prefix:connection_data.temp_prefix,tables:U.join(","),nonce:wpsdb_nonces.finalize_migration},error:function(e,t,n){b(".progress-title").html(wpsdb_i10n.migration_failed),b(".progress-text").html(wpsdb_i10n.finalize_tables_problem),b(".progress-text").addClass("migration-error"),alert(e+" : "+t+" : "+n),migration_error=!0,migration_complete_events()},success:function(e){if(""!=b.trim(e))return b(".progress-title").html(wpsdb_i10n.migration_failed),b(".progress-text").html(e),b(".progress-text").addClass("migration-error"),migration_error=!0,void migration_complete_events();next_step_in_migration={fn:wpsdb_call_next_hook},execute_next_step()}})},b("body").on("click",".close-progress-content-button",function(e){s()}),b("body").on("click","#overlay",function(){1==$&&s()}),b(".save-settings-button").click(function(e){var t;if(b(this).blur(),e.preventDefault(),!A)if(b("#migrate-selected").is(":checked")&&null==b("#select-tables").val())alert(wpsdb_i10n.please_select_one_table);else{if(""==b.trim(b(".create-new-profile").val())&&b("#create_new").is(":checked"))return alert(wpsdb_i10n.enter_name_for_profile),void b(".create-new-profile").focus();var i=!1;b("#create_new").is(":checked")&&(i=!0);var o=b(".create-new-profile").val();A=!0,t=b("#migrate-form").serialize(),b(".save-settings-button").after('<img src="'+B+'" alt="" class="save-profile-ajax-spinner general-spinner" />'),b(this).attr("disabled","disabled"),b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_save_profile",profile:t,nonce:wpsdb_nonces.save_profile},error:function(e,t,n){alert(wpsdb_i10n.save_profile_problem),b(".save-settings-button").removeAttr("disabled"),b(".save-profile-ajax-spinner").remove(),b(".save-settings-button").after('<span class="ajax-success-msg">'+wpsdb_i10n.saved+"</span>"),b(".ajax-success-msg").fadeOut(2e3,function(){b(this).remove()}),A=!1},success:function(e){if(b(".save-settings-button").removeAttr("disabled"),b(".save-profile-ajax-spinner").remove(),b(".save-settings-button").after('<span class="ajax-success-msg">'+wpsdb_i10n.saved+"</span>"),b(".ajax-success-msg").fadeOut(2e3,function(){b(this).remove()}),A=!1,b(".create-new-profile").val(""),i){var t=parseInt(e,10),n=t+1,s='<li><span style="display: none;" class="delete-profile" data-profile-id="'+n+'"></span><label for="profile-'+n+'"><input id="profile-'+n+'" value="'+t+'" name="save_migration_profile_option" type="radio"> '+o+"</label></li>";b("#create_new").parents("li").before(s),b("#profile-"+n).attr("checked","checked")}}})}}),b("body").on("mousemove",".progress-chunk-hover",function(e){mX=e.pageX,offset=b(".progress-bar-wrapper").offset(),label_offset=b(".progress-label").outerWidth()/2,mX=mX-offset.left-label_offset,b(".progress-label").css("left",mX+"px"),b(".progress-label").html(b(this).attr("data-table"))}),b("body").on("mouseenter mouseleave",".progress-chunk-hover",function(e){"mouseenter"===e.type?b(".progress-label").addClass("label-visible"):b(".progress-label").removeClass("label-visible")}),connection_info_box=b(".connection-info-wrapper"),h(),b(".migrate-selection.option-group input[type=radio]").change(function(){h(),T&&(b("#push").is(":checked")||b("#savefile").is(":checked")?(""!=z&&"pull"!=z||b(".replace-row").each(function(){var e=b(".old-replace-col input",this).val();b(".old-replace-col input",this).val(b(".replace-right-col input",this).val()),b(".replace-right-col input",this).val(e)}),b("#select-tables").remove(),b(".select-tables-wrap").prepend(e),b("#select-post-types").remove(),b(".select-post-types-wrap").prepend(t),b("#select-backup").remove(),b(".backup-tables-wrap").prepend(d),z="push"):b("#pull").is(":checked")&&(""!=z&&"push"!=z||b(".replace-row").each(function(){var e=b(".old-replace-col input",this).val();b(".old-replace-col input",this).val(b(".replace-right-col input",this).val()),b(".replace-right-col input",this).val(e)}),b("#select-tables").remove(),b(".select-tables-wrap").prepend(c),b("#select-post-types").remove(),b(".select-post-types-wrap").prepend(p),b("#select-backup").remove(),b(".backup-tables-wrap").prepend(u),z="pull"))}),!b("#pull").is(":checked")&&!b("#push").is(":checked")||T||(b(".step-two").hide(),b(".connection-status").show()),b(".general-helper").click(function(e){var t=b(this),n=b(this).next();b(".helper-message").not(n).hide();var s=t.position();n.hasClass("bottom")?n.css({left:s.left-n.width()/2+"px",top:s.top+t.height()+9+"px"}):n.css({left:s.left+t.width()+9+"px",top:s.top+t.height()/2-18+"px"}),n.toggle(),e.stopPropagation()}),b("body").click(function(){b(".helper-message").hide()}),b(".helper-message").click(function(e){e.stopPropagation()}),b(".nav-tab").click(function(){b(".nav-tab").removeClass("nav-tab-active"),b(this).addClass("nav-tab-active"),b(".content-tab").hide(),b("."+b(this).attr("data-div-name")).show();var e=b(this).attr("data-div-name");e=e.replace("-tab",""),window.location.hash=e,b(this).hasClass("help")&&n()}),b("body").on("click",".add-row",function(){b(this).parents("tr").before(b(".original-repeatable-field").clone().removeClass("original-repeatable-field"))}),b("body").on("click",".replace-remove-row",function(){b(this).parents("tr").remove(),b(".replace-row").length<2&&b(".no-replaces-message").show()}),b(".add-replace").click(function(){b(".replace-fields").prepend(b(".original-repeatable-field").clone().removeClass("original-repeatable-field")),b(".no-replaces-message").hide()}),b("body").on("mouseenter mouseleave","#find-and-replace-sort tbody tr.replace-row",function(e){"mouseenter"===e.type?b(".replace-remove-row",this).show():b(".replace-remove-row",this).hide()}),b("#find-and-replace-sort tbody").sortable({items:"> tr:not(.pin)",handle:"td:first",start:function(){b(".sort-handle").css("cursor","-webkit-grabbing"),b(".sort-handle").css("cursor","-moz-grabbing")},stop:function(){b(".sort-handle").css("cursor","-webkit-grab"),b(".sort-handle").css("cursor","-moz-grab")}}),b("body").on("mouseenter mouseleave",".save-migration-profile-wrap li",function(e){"mouseenter"===e.type?b(".delete-profile",this).show():b(".delete-profile",this).hide()}),window.location.hash){var i=window.location.hash.substring(1);o(i,!1)}function o(e,t){b(".nav-tab").removeClass("nav-tab-active"),b(".nav-tab."+e).addClass("nav-tab-active"),b(".content-tab").hide(),b("."+e+"-tab").show(),"help"==e&&n()}function a(e){var t=b(".pull-push-connection-info");if(!D&&!b(t).hasClass("temp-disabled")){e=b(".pull-push-connection-info").val();var i=b.trim(e).split("\n"),n=!1,s="";if(""==i&&(n=!0,s=wpsdb_i10n.connection_info_missing),2==i.length||n||(n=!0,s=wpsdb_i10n.connection_info_incorrect),n||validate_url(i[0])||(n=!0,s=wpsdb_i10n.connection_info_url_invalid),n||32==i[1].length||(n=!0,s=wpsdb_i10n.connection_info_key_invalid),n||i[0]!=wpsdb_connection_info[0]||(n=!0,s=wpsdb_i10n.connection_info_local_url),n||i[1]!=wpsdb_connection_info[1]||(n=!0,s=wpsdb_i10n.connection_info_local_key),n)return b(".connection-status").html(s),void b(".connection-status").addClass("notification-message error-notice migration-error");if(0==wpsdb_openssl_available){i[0]=i[0].replace("https://","http://");var o=i[0]+"\n"+i[1];b(".pull-push-connection-info").val(o)}if(D=!(E=!1),l(),b(".basic-access-auth-wrapper").is(":visible")){i[0]=i[0].replace(/\/\/(.*)@/,"//"),i[0]=i[0].replace("//","//"+encodeURIComponent(b.trim(b(".auth-username").val()))+":"+encodeURIComponent(b.trim(b(".auth-password").val()))+"@");o=i[0]+"\n"+i[1];b(".pull-push-connection-info").val(o),b(".basic-access-auth-wrapper").hide()}b(".step-two").hide(),b(".ssl-notice").hide(),b(".prefix-notice").hide(),b(".connection-status").show(),b(".connection-status").html(wpsdb_i10n.establishing_remote_connection),b(".connection-status").removeClass("notification-message error-notice migration-error"),b(".connection-status").append('<img src="'+B+'" alt="" class="ajax-spinner general-spinner" />');var a=b("input[name=action]:checked").val();P=!1,b.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"wpsdb_verify_connection_to_remote_site",url:i[0],key:i[1],intent:a,nonce:wpsdb_nonces.verify_connection_to_remote_site},error:function(e,t,n){b(".connection-status").html(wpsdb_i10n.connection_local_server_problem+" (#100)"),b(".connection-status").append("<br /><br />Status: "+e.status+" "+e.statusText+"<br /><br />Response:<br />"+e.responseText),b(".connection-status").addClass("notification-message error-notice migration-error"),b(".ajax-spinner").remove(),D=!1,_()},success:function(e){if(b(".ajax-spinner").remove(),D=!1,_(),void 0!==e.wpsdb_error&&1==e.wpsdb_error)return b(".connection-status").html(e.body),b(".connection-status").addClass("notification-message error-notice migration-error"),void(-1<e.body.indexOf("401 Unauthorized")&&b(".basic-access-auth-wrapper").show());var t=K(i[0]);b(".create-new-profile").val(t),b(".pull-push-connection-info").addClass("temp-disabled"),b(".pull-push-connection-info").attr("readonly","readonly"),b(".connect-button").hide(),b(".connection-status").hide(),b(".step-two").show(),J(i[0],i[1],e.scheme),V(e.plugin_version,i[0]),G(e.prefix),T=!0,connection_data=e,h();var n=document.createElement("select");b(n).attr({multiple:"multiple",name:"select_tables[]",id:"select-tables",class:"multiselect"}),b.each(connection_data.tables,function(e,t){b(n).append('<option value="'+t+'">'+t+" ("+connection_data.table_sizes_hr[t]+")</option>")}),d=b(c=n).clone(),b(d).attr({name:"select_backup[]",id:"select-backup"});var s=document.createElement("select");b(s).attr({multiple:"multiple",name:"select_post_types[]",id:"select-post-types",class:"multiselect"}),b.each(connection_data.post_types,function(e,t){b(s).append('<option value="'+t+'">'+t+"</option>")}),p=s,b("#pull").is(":checked")?(b("#new-url").val(Y(wpsdb_this_url)),b("#new-path").val(wpsdb_this_path),1==wpsdb_is_multisite&&b("#new-domain").val(wpsdb_this_domain),b("#old-url").val(Y(e.url)),b("#old-path").val(e.path),b("#select-tables").remove(),b(".select-tables-wrap").prepend(c),b("#select-post-types").remove(),b(".select-post-types-wrap").prepend(p),b(".table-prefix").html(e.prefix),b(".uploads-dir").html(wpsdb_this_uploads_dir)):(b("#select-backup").remove(),b(".backup-tables-wrap").prepend(d),b("#new-url").val(Y(e.url)),b("#new-path").val(e.path)),next_step_in_migration={fn:b.wpsdb.do_action,args:["verify_connection_to_remote_site",connection_data]},execute_next_step()}})}}""!=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null==t?"":decodeURIComponent(t[1].replace(/\+/g," "))}("install-plugin")&&o(i="addons",!0),b(".reset-api-key").click(function(){confirm(wpsdb_i10n.reset_api_key)&&!O&&(O=!0,b(".reset-api-key").after('<img src="'+B+'" alt="" class="reset-api-key-ajax-spinner general-spinner" />'),b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_reset_api_key",nonce:wpsdb_nonces.reset_api_key},error:function(e,t,n){alert(wpsdb_i10n.reset_api_key_problem),b(".reset-api-key-ajax-spinner").remove(),O=!1},success:function(e){b(".reset-api-key-ajax-spinner").remove(),O=!1,b(".connection-info").html(e)}}))}),b("input.multiselect-toggle").change(function(){b(this).parents(".expandable-content").children(".select-wrap").toggle()}),b(".show-multiselect").each(function(){b(this).is(":checked")&&(b(this).parents(".option-section").children(".header-expand-collapse").children(".expand-collapse-arrow").removeClass("collapsed"),b(this).parents(".expandable-content").show(),b(this).parents(".expandable-content").children(".select-wrap").toggle())}),b("input[name=backup_option]").change(function(){b(".backup-tables-wrap").hide(),"backup_manual_select"==b(this).val()&&b(".backup-tables-wrap").show()}),b("#backup-manual-select").is(":checked")&&b(".backup-tables-wrap").show(),b(".plugin-compatibility-save").click(function(){S||(b(this).addClass("disabled"),select_element=b("#selected-plugins"),b(select_element).attr("disabled","disabled"),S=!0,b(this).after('<img src="'+B+'" alt="" class="plugin-compatibility-spinner general-spinner" />'),b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_blacklist_plugins",blacklist_plugins:b(select_element).val()},error:function(e,t,n){alert("A problem occurred when trying to add plugins to backlist.\r\n\r\nStatus: "+e.status+" "+e.statusText+"\r\n\r\nResponse:\r\n"+e.responseText),b(select_element).removeAttr("disabled"),b(".plugin-compatibility-save").removeClass("disabled"),S=!1,b(".plugin-compatibility-spinner").remove(),b(".plugin-compatibility-success-msg").show().fadeOut(2e3)},success:function(e){""!=b.trim(e)&&alert(e),b(select_element).removeAttr("disabled"),b(".plugin-compatibility-save").removeClass("disabled"),S=!1,b(".plugin-compatibility-spinner").remove(),b(".plugin-compatibility-success-msg").show().fadeOut(2e3)}}))}),b("body").on("click",".delete-profile",function(){var e=b(this).next().clone();b("input",e).remove();e=b.trim(b(e).html());confirm(wpsdb_i10n.remove_profile+' "'+e+'"')&&(b(this).parent().fadeOut(500),b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_delete_migration_profile",profile_id:b(this).attr("data-profile-id"),nonce:wpsdb_nonces.delete_migration_profile},error:function(e,t,n){alert(wpsdb_i10n.remove_profile_problem)},success:function(e){"-1"==e&&alert(wpsdb_i10n.remove_profile_not_found)}}))}),b(".main-list-delete-profile-link").click(function(){var e=b(this).prev().html();confirm(wpsdb_i10n.remove_profile+' "'+e+'"')&&(b(this).parent().fadeOut(500),b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_delete_migration_profile",profile_id:b(this).attr("data-profile-id"),nonce:wpsdb_nonces.delete_migration_profile},error:function(e,t,n){alert(wpsdb_i10n.remove_profile_problem)}}))}),b("body").on("click",".temp-disabled",function(){confirm(wpsdb_i10n.change_connection_info)&&(b(".ssl-notice").hide(),b(".different-plugin-version-notice").hide(),b(".migrate-db-button").show(),b(".temp-disabled").removeAttr("readonly"),b(".temp-disabled").removeClass("temp-disabled"),b(".connect-button").show(),b(".step-two").hide(),b(".connection-status").show().html(wpsdb_i10n.enter_connection_info),T=!1)}),b(".settings-tab input[type=checkbox]").change(function(){if("plugin-compatibility"!=b(this).attr("id")){var e=b(this).is(":checked"),t=b(this).attr("id");b(this).parent().append('<img src="'+B+'" alt="" class="ajax-spinner general-spinner" />');var n=b(this).parent();b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpsdb_save_setting",checked:e,setting:t,nonce:wpsdb_nonces.save_setting},error:function(e,t,n){alert(wpsdb_i10n.save_settings_problem),b(".ajax-spinner").remove()},success:function(e){b(".ajax-spinner").remove(),b(n).append('<span class="ajax-success-msg">'+wpsdb_i10n.saved+"</span>"),b(".ajax-success-msg").fadeOut(2e3,function(){b(this).remove()})}})}}),b(".migrate-form").submit(function(e){e.preventDefault()}),b(".connect-button").click(function(e){e.preventDefault(),b(this).blur(),a()}),b(".pull-push-connection-info").bind("paste",function(e){setTimeout(function(){a()},0)}),b("body").on("click",".try-again",function(){a()}),b("body").on("click",".try-http",function(){var e=b.trim(b(".pull-push-connection-info").val()).split("\n"),t=e[0].replace("https","http")+"\n"+e[1];b(".pull-push-connection-info").val(t),a()}),b(".create-new-profile").change(function(){P=!0}),b("body").on("click",".temporarily-disable-ssl",function(){if(window.location.hash)var e=window.location.hash.substring(1);b(this).attr("href",b(this).attr("href")+"&hash="+e)}),b("body").on("click",".pause-resume",function(){1==X?(D=!(X=!1),b(".progress-title").html(y),b(".progress-text").html(F),b(".migration-progress-ajax-spinner").show(),b(".pause-resume").html(wpsdb_i10n.pause),x=setInterval(N,1e3),execute_next_step()):(D=!(X=!0),y=b(".progress-title").html(),F=b(".progress-text").html(),b(".progress-title").html(wpsdb_i10n.migration_paused),b(".pause-resume").html(wpsdb_i10n.resume),b(".progress-text").html(wpsdb_i10n.completing_current_request))}),b("body").on("click",".cancel",function(){X=!(W=!0),b(".progress-text").html(wpsdb_i10n.completing_current_request),b(".progress-title").html(wpsdb_i10n.cancelling_migration),b(".migration-controls").fadeOut(),b(".migration-progress-ajax-spinner").show(),0==D&&execute_next_step()}),execute_next_step=function(){if(1==X)return b(".migration-progress-ajax-spinner").hide(),clearInterval(x),void b(".progress-text").html(wpsdb_i10n.paused);if(1==W){"savefile"==(m=b("input[name=action]:checked").val())?progress_msg=wpsdb_i10n.removing_local_sql:"pull"==m?progress_msg="backup"==v?wpsdb_i10n.removing_local_backup:wpsdb_i10n.removing_local_temp_tables:"push"==m&&(progress_msg="backup"==v?wpsdb_i10n.removing_remote_sql:wpsdb_i10n.removing_remote_temp_tables),b(".progress-text").html(progress_msg);var e={action:"wpsdb_cancel_migration",intent:m,url:f,key:g,stage:v,dump_filename:R,form_data:w};void 0!==connection_data&&(e.temp_prefix=connection_data.temp_prefix),b.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:e,error:function(e,t,n){b(".progress-title").html(wpsdb_i10n.migration_cancellation_failed),b(".progress-text").html(wpsdb_i10n.manually_remove_temp_files),b(".progress-text").append("<br /><br />Status: "+e.status+" "+e.statusText+"<br /><br />Response:<br />"+e.responseText),b(".progress-text").addClass("migration-error"),console.log(e),console.log(t),console.log(n),migration_error=!0,migration_complete_events()},success:function(e){if(D=!1,""!=(e=b.trim(e)))return b(".progress-title").html(wpsdb_i10n.migration_cancellation_failed),b(".progress-text").html(e),b(".progress-text").addClass("migration-error"),migration_error=!0,void migration_complete_events();k=wpsdb_i10n.migration_cancelled,b(".progress-text").hide(),migration_complete_events()}})}else next_step_in_migration.fn.apply(null,next_step_in_migration.args)}})}(jQuery);